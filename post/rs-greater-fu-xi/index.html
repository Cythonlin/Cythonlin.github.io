<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RS =&gt; æ¨èç³»ç»Ÿï¼ˆä¸ƒï¼‰DL-Wide&amp;Deep | Cython_lin</title>
<meta name="description" content="" />
<link rel="shortcut icon" href="https://cythonlin.github.io/favicon.ico">
<link rel="stylesheet" href="https://cythonlin.github.io/styles/main.css">

<script src="https://cythonlin.github.io/media/js/jquery.min.js"></script>
<script src="https://cythonlin.github.io/media/js/masonry.pkgd.min.js"></script>
<script src="https://cythonlin.github.io/media/js/aos.js"></script>
<script src="https://cythonlin.github.io/media/js/pace.min.js"></script>
<script src="https://cythonlin.github.io/media/js/view-image.min.js"></script>
<script src="https://cythonlin.github.io/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://cythonlin.github.io/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="TF20
=&gt; [TF20å‰é¢å†™è¿‡ï¼Œç›´æ¥è§
=&gt; Tensorflow2.0è¯­æ³• - å¼ é‡&amp;åŸºæœ¬å‡½æ•°(ä¸€)
=&gt; Tensorflow2.0è¯­æ³• - datasetæ•°æ®å°è£…+è®­æµ‹éªŒåˆ‡å‰²ï¼ˆäºŒï¼‰
=&gt; Tenso..." />
    <meta name="keywords" content="RS,Python" />
    <script src="https://cythonlin.github.io/media/js/waterfall.min.js"></script>
    <script src="https://cythonlin.github.io/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://cythonlin.github.io"><img src="\media\images\custom-headerLogo.png" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://cythonlin.github.io" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tags" class="menu">
                      æ ‡ç­¾
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="https://cythonlin.github.io/post/the-future-is-promising" class="menu">
                      å…³äº
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1615878742766" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('/media/images/gridea.jpg');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2021-02-28"><i class="fa fa-calendar"></i><span class="lately">16 å¤©å‰</span></time>
              
              <a href="https://cythonlin.github.io/post/rs-greater-fu-xi/#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/rs-greater-fu-xi/"> </span>
              </a>
              <span id="/rs-greater-fu-xi/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://cythonlin.github.io/tag/EjFvvnhFs/" class="ctag ctag-0 ctag-EjFvvnhFs" aria-label="">RS</a>
                    
                      <a href="https://cythonlin.github.io/tag/wAXYBHxvH/" class="ctag ctag-1 ctag-wAXYBHxvH" aria-label="">Python</a>
                    
              </div>
              <h1 class="title ularge white bold">RS =&gt; æ¨èç³»ç»Ÿï¼ˆä¸ƒï¼‰DL-Wide&amp;Deep</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <h1 id="tf20">TF20</h1>
<p>=&gt; [TF20å‰é¢å†™è¿‡ï¼Œç›´æ¥è§<br>
<a href="https://www.cklin.top/post/ai-greater-tensorflow20-yu-fa-zhang-liang-andji-ben-han-shu-yi/">=&gt; Tensorflow2.0è¯­æ³• - å¼ é‡&amp;åŸºæœ¬å‡½æ•°(ä¸€)</a><br>
<a href="https://www.cklin.top/post/ai-greater-tensorflow20-yu-fa-dataset-shu-ju-feng-zhuang-xun-ce-yan-qie-ge-er/">=&gt; Tensorflow2.0è¯­æ³• - datasetæ•°æ®å°è£…+è®­æµ‹éªŒåˆ‡å‰²ï¼ˆäºŒï¼‰</a><br>
<a href="https://www.cklin.top/post/ai-greater-tensorflow20-yu-fa-keras_api-de-shi-yong-san/">=&gt; Tensorflow2.0è¯­æ³• - keras_APIçš„ä½¿ç”¨(ä¸‰)</a><br>
<a href="https://www.cklin.top/post/py-greater-tensorflow20-mo-xing-bao-cun-yu-bu-shu/">=&gt; PY =&gt; Tensorflow2.0æ¨¡å‹ä¿å­˜ä¸éƒ¨ç½²(å››)</a><br>
<a href="https://www.cklin.top/post/py-greater-tensorflow20-gpu-guan-li-yu-fen-bu-shi/">=&gt; Tensorflow2.0 GPUç®¡ç†ä¸åˆ†å¸ƒå¼(äº”)</a></p>
<h1 id="tfå¤„ç†mlæ­¥éª¤estimator">TFå¤„ç†MLæ­¥éª¤ï¼ˆEstimatorï¼‰</h1>
<h3 id="ä¸€-ç¼–å†™æ•°æ®é›†å¯¼å…¥å‡½æ•°æ­¤å‡½æ•°å¿…é¡»è¿”å›2ä¸ªå¯¹è±¡">ä¸€ã€ç¼–å†™æ•°æ®é›†å¯¼å…¥å‡½æ•°ï¼Œæ­¤å‡½æ•°å¿…é¡»è¿”å›2ä¸ªå¯¹è±¡ï¼š</h3>
<pre><code>1. å­—å…¸ä¸º {&quot;ç‰¹å¾åç§°&quot;: ç‰¹å¾å€¼Tensor æˆ– SparseTensor}
2. labelçš„Tensoråˆ—è¡¨
</code></pre>
<p>æ ¼å¼ï¼š</p>
<pre><code>def input_fn(dataset):
    ...
    return feature_dict, label    # è¿™2ç»„åˆä¸ºå¼ é‡è¿­ä»£å™¨ï¼Œ å°±æ˜¯ dataset
</code></pre>
<h3 id="äºŒ-å®šä¹‰ç‰¹å¾åˆ—-tffeature_column">äºŒã€ å®šä¹‰ç‰¹å¾åˆ—ï¼ˆ tf.feature_columnï¼‰</h3>
<pre><code>a = tf.feature_column.numeric_column('a')
b = tf.feature_column.numeric_column('b')
c = tf.feature_column.numeric_column('c', normalizer_fn=lambda x: x)
</code></pre>
<h3 id="ä¸‰-å®ä¾‹åŒ–ç›¸å…³çš„é¢„åˆ›å»ºçš„-estimator">ä¸‰ã€å®ä¾‹åŒ–ç›¸å…³çš„é¢„åˆ›å»ºçš„ Estimator</h3>
<pre><code>estimator = tf.estimator.LinearClassifier(
    feature_columns=[a,b,c]
)
</code></pre>
<h3 id="å››-è°ƒç”¨è®­ç»ƒ-è¯„ä¼°æˆ–æ¨ç†æ–¹æ³•">å››ã€è°ƒç”¨è®­ç»ƒã€è¯„ä¼°æˆ–æ¨ç†æ–¹æ³•</h3>
<pre><code>.train(æ•°æ®é›†å¤„ç†å‡½æ•°å¥æŸ„ï¼Œsteps=None)
estimator.predict(æ•°æ®é›†å¤„ç†å‡½æ•°å¥æŸ„,predict_keys=None, steps=None)
.estimator.evaluate(æ•°æ®é›†å¤„ç†å‡½æ•°å¥æŸ„ï¼Œsteps=None)
</code></pre>
<h1 id="å¸¸ç”¨-estimator">å¸¸ç”¨ estimator</h1>
<pre><code>tf.estimator.DNNClassifier(hidden_units,feature_columns)
tf.estimator.DNNRegressor(hidden_units,feature_columns)

tf.estimator.LinearClassifier(feature_columns)
tf.estimator.LinearRegressor(feature_columns)

tf.estimator.DNNLinearCombinedClassifier()
tf.estimator.DNNLinearCombinedRegressor()
</code></pre>
<h1 id="å¸¸ç”¨-feature_columnæŒ‡å®šestimatorå­—æ®µçš„æ•°æ®ç±»å‹">å¸¸ç”¨ feature_columnï¼ˆæŒ‡å®šestimatorå­—æ®µçš„æ•°æ®ç±»å‹ï¼‰</h1>
<h2 id="æ•°å€¼å‹">æ•°å€¼å‹</h2>
<ul>
<li>æ•°å€¼åˆ—ï¼ˆtf.feature_column.numeric_columnï¼‰</li>
<li>æŒ‡æ ‡åˆ—ï¼ˆtf.feature_column.indicator_columnï¼‰</li>
</ul>
<h2 id="ç±»åˆ«å‹">ç±»åˆ«å‹</h2>
<ul>
<li>åˆ†æ¡¶åˆ—ï¼ˆtf.feature_column.bucketized_columnï¼‰ ï¼ˆç›¸å½“äºæ•°å€¼å‹æ•°æ®åˆ†ç»„-one-hotï¼‰</li>
<li>åˆ†ç±»æ ‡è¯†åˆ—ï¼ˆtf.feature_column.categorical_column_with_identityï¼‰</li>
<li>åˆ†ç±»è¯æ±‡åˆ—ï¼ˆtf.feature_column.categorical_column_with_vocabulary_list æˆ–è€… tf.feature_column.categorical_column_with_vocabulary_fileï¼‰</li>
<li>ç»è¿‡å“ˆå¸Œå¤„ç†çš„åˆ—ï¼ˆtf.feature_column.categorical_column_with_hash_bucketï¼‰</li>
</ul>
<h2 id="ç‰¹å¾äº¤å‰embeddingç±»å‹">ç‰¹å¾äº¤å‰+Embeddingç±»å‹</h2>
<ul>
<li>ç»„åˆåˆ—ï¼ˆtf.feature_column.crossed_columnï¼‰ç‰¹å¾äº¤å‰</li>
<li>åµŒå…¥åˆ—ï¼ˆtf.feature_column.embedding_columnï¼‰</li>
</ul>
<h2 id="ç‰¹æ®Šè¯´æ˜æ•°å€¼åˆ—">ç‰¹æ®Šè¯´æ˜æ•°å€¼åˆ—</h2>
<p>åŸå°ä¸åŠ¨ï¼ˆå½“ç„¶å¯ä»¥æŒ‡å®šæ•°æ®ç±»å‹ç­‰ï¼‰</p>
<pre><code>numeric_feature_column = tf.feature_column.numeric_column(key=&quot;SepalLength&quot;)
</code></pre>
<h2 id="ç‰¹æ®Šè¯´æ˜åˆ†æ¡¶åˆ—bucketized_column">ç‰¹æ®Šè¯´æ˜åˆ†æ¡¶åˆ—ï¼ˆbucketized_columnï¼‰</h2>
<p>ç›®æ ‡ï¼š</p>
<pre><code>æ—¥æœŸèŒƒå›´	                 è¡¨ç¤ºä¸ºâ€¦
&lt; 1960 å¹´	                [1, 0, 0, 0]
&gt;= 1960 å¹´ and &lt; 1980 å¹´	[0, 1, 0, 0]
&gt;= 1980 å¹´ and &lt; 2000 å¹´	[0, 0, 1, 0]
&gt;= 2000 å¹´	                [0, 0, 0, 1]
</code></pre>
<p>å®ç°:</p>
<pre><code># é¦–å…ˆï¼Œå°†åŸå§‹è¾“å…¥è½¬æ¢ä¸ºä¸€ä¸ªnumeric column
numeric_feature_column = tf.feature_column.numeric_column(&quot;Year&quot;)

# ç„¶åï¼ŒæŒ‰ç…§è¾¹ç•Œ[1960,1980,2000]å°†numeric columnè¿›è¡Œbucketï¼Œç„¶åè‡ªåŠ¨one-hot
bucketized_feature_column = tf.feature_column.bucketized_column(
    source_column = numeric_feature_column,
    boundaries = [1960, 1980, 2000])
</code></pre>
<h2 id="ç‰¹æ®Šè¯´æ˜åˆ†ç±»æ ‡è¯†ç±»">ç‰¹æ®Šè¯´æ˜åˆ†ç±»æ ‡è¯†ç±»</h2>
<p>å°±æ˜¯æŠŠ  0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4  è½¬ä¸ºæ ‡å‡†one-hot</p>
<pre><code>identity_feature_column = tf.feature_column.categorical_column_with_identity(
    key='my_feature_b',
    num_buckets=vocab_size) # Values [0, 4)
</code></pre>
<h2 id="ç‰¹æ®Šè¯´æ˜åˆ†ç±»è¯æ±‡åˆ—">ç‰¹æ®Šè¯´æ˜åˆ†ç±»è¯æ±‡åˆ—</h2>
<p>å°±æ˜¯æŠŠæ™®é€šå­—ç¬¦ä¸²ç±»åˆ«ï¼Œè½¬ä¸ºæ ‡å‡†one-hot</p>
<pre><code>vocabulary_feature_column =
    tf.feature_column.categorical_column_with_vocabulary_list(
        key=feature_name_from_input_fn,
        vocabulary_list=[&quot;kitchenware&quot;, &quot;electronics&quot;, &quot;sports&quot;])
</code></pre>
<h2 id="ç‰¹æ®Šè¯´æ˜åˆ†ç±»è¯æ±‡åˆ—-2">ç‰¹æ®Šè¯´æ˜åˆ†ç±»è¯æ±‡åˆ—</h2>
<p>å½“ç±»åˆ«çš„æ•°é‡ç‰¹åˆ«å¤§æ—¶ï¼Œè‹¥å°†æ¯ä¸ªè¯æ±‡æˆ–æ•´æ•°è®¾ç½®å•ç‹¬çš„ç±»åˆ«ï¼Œä¼šæ¶ˆè€—éå¸¸å¤§çš„å†…å­˜ã€‚<br>
æˆ‘ä»¬å¯å¤§è‡´ç»™å®šç±»åˆ«å€¼ï¼Œè®©æ¨¡å‹è‡ªå·±å»åšhashï¼Œç„¶åæ˜ å°„åˆ°è®¾å®šçš„ç±»åˆ«ï¼ˆæ¡¶ï¼‰ä¸­ï¼Œå¹¶å­¦ä¹ æ‹Ÿåˆåˆ°è¿™äº›ç±»åˆ«</p>
<pre><code>hashed_feature_column =
    tf.feature_column.categorical_column_with_hash_bucket(
        key = &quot;some_feature&quot;,
        hash_bucket_size = 100) # å°±è®¾å®š100ä¸ªç±»åˆ«
</code></pre>
<h3 id="feature_columnå®ä¾‹">feature_columnå®ä¾‹</h3>
<pre><code>a = tf.feature_column.numeric_column(&quot;æ•°å€¼å­—æ®µ&quot;)

# å·²çŸ¥ç±»åˆ«ä¸ªæ•°
b = tf.feature_column.categorical_column_with_vocabulary_file(
    &quot;ç±»åˆ«å­—æ®µåç§°&quot;,
    [&quot;ç±»åˆ«&quot;, &quot;ç±»åˆ«2&quot;,...,&quot;ç±»åˆ«n&quot;]  # æŠŠæ‰€æœ‰ç±»åˆ«å­—ç¬¦ä¸²è½¬ä¸º ID 0,1,2,...,n
)

# å’Œä¸Šè¿°ç±»ä¼¼ï¼ŒæœªçŸ¥ç±»åˆ«ä¸ªæ•°æ—¶ï¼Œç”¨åˆ†æ¡¶
c = tf.feature_column.categorical_column_with_hash_bucket(
    &quot;ç±»åˆ«å­—æ®µåç§°&quot;,
    hash_bucket_size=2000       # è¶Šå¤§ï¼Œå†²çªè¶Šå°‘
)
</code></pre>
<p>æœ€åå°† feature_columnçš„ç»“æœï¼Œç»„è£…æˆåˆ—è¡¨ï¼Œ è¿”å›ç»™æ¨¡å‹æ„é€ ã€‚<br>
ğŸ‘‰eg:</p>
<pre><code>feature_columns = [a, b, c]
classifier = tf.estimator.LinearClassifier(feature_columns)
</code></pre>
<p>ğŸ‘‰æ­£å¼è®­ç»ƒæ¨¡å‹ï¼š</p>
<pre><code>classifier.train(æ•°æ®é›†å¤„ç†å‡½æ•°å¥æŸ„(å°±æ˜¯ä¸Šé¢è¿”å›datasetçš„é‚£ä¸ª)ï¼Œsteps=None)
</code></pre>
<h2 id="ä¸Šé¢çš„datasetå‡½æ•°å¥æŸ„å¦‚ä¸‹å®˜æ–¹csvæ“ä½œå®ä¾‹">ğŸ‘‰ä¸Šé¢çš„datasetå‡½æ•°å¥æŸ„å¦‚ä¸‹(å®˜æ–¹CSVæ“ä½œå®ä¾‹)ï¼š</h2>
<pre><code>TRAIN_DATA_URL = &quot;https://storage.googleapis.com/tf-datasets/titanic/train.csv&quot;
TEST_DATA_URL = &quot;https://storage.googleapis.com/tf-datasets/titanic/eval.csv&quot;

# æŠŠæ•°æ®ä¸‹è½½åˆ°æ­¤è·¯å¾„ä¸‹
train_file_path = tf.keras.utils.get_file(&quot;train.csv&quot;, TRAIN_DATA_URL)
# 'C:\\Users\\lin\\.keras\\datasets\\train.csv'
test_file_path = tf.keras.utils.get_file(&quot;eval.csv&quot;, TEST_DATA_URL)
# 'C:\\Users\\lin\\.keras\\datasets\\eval.csv'

CSV_COLUMNS = ['survived', 'sex', 'age', 'n_siblings_spouses', 'parch', 'fare', 'class', 'deck', 'embark_town', 'alone']
LABEL_COLUMN = 'survived'
LABELS = [0, 1]

def get_dataset(file_path):
    &quot;&quot;&quot;
    çœŸæ­£æ“ä½œCSVçš„å‡½æ•°
    &quot;&quot;&quot;
    dataset = tf.data.experimental.make_csv_dataset(
        file_path,
        batch_size=12,
        column_names=CSV_COLUMNS,
        label_name=LABEL_COLUMN,
        na_value=&quot;?&quot;,
        num_epochs=1,
        ignore_errors=True)
    return dataset
    # åªè¦æˆ‘ä»¬å°†  column_namesï¼Œ label_name è¿™2ä¸ªå­—æ®µæŒ‡å®šå¥½
    # make_csv_dataset å°†ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç»„è£… datasetæ ¼å¼ ï¼ˆåŒ…æ‹¬ feature_dict å’Œ lableçš„è¿­ä»£å™¨ï¼‰å¹¶return
</code></pre>
<p>ğŸ‘‰å› ä¸ºè¦ä¼ å‡½æ•°å¥æŸ„ï¼ˆå°±æ˜¯å‡½æ•°åï¼‰ï¼Œè€Œä¸æ˜¯è°ƒç”¨ï¼Œæ‰€ä»¥é¢å¤–çš„å‚æ•°ï¼Œéœ€è¦ç”¨åˆ°åå‡½æ•°è§£å†³</p>
<pre><code>from functools import partial
# è¯»å–ä¸Šé¢è·¯å¾„ä¸‹çš„CSV
train_func = partial(get_dataset, train_file_path)
test_func = partial(get_dataset, test_file_path)
classifier.train(train_func)
result = classifier.evaluate(test_func) 
print(result)
</code></pre>
<h1 id="tfdataæ–‡ä»¶éƒ½æ˜¯-datasetçš„å­é›†">tf.data(æ–‡ä»¶)éƒ½æ˜¯ datasetçš„å­é›†</h1>
<pre><code>tf.data.TextLineDataset - ä»æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–è¡Œã€‚
tf.data.TFRecordDataset - ä» TFRecord æ–‡ä»¶ä¸­è¯»å–è®°å½•ã€‚
tf.data.FixedLengthRecordDataset - ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è¯»å–å…·æœ‰å›ºå®šå¤§å°çš„è®°å½•ã€‚
</code></pre>
<h1 id="datasetè½¬iter">datasetè½¬iter</h1>
<pre><code>dataset1 = tf.data.Dataset.range(10)
c = dataset1.__iter__()
print(c.get_next()) 
print(c.get_next())
print(c.get_next())
</code></pre>
<p>ğŸ‘‰Note: ä¸è¦ç”¨next() ä¹Ÿä¸è¦ç”¨ __next__()<br>
ğŸ‘‰æ³¨æ„ï¼šå¦‚æœ __iter__() æ‰¾ä¸åˆ° get_next()<br>
ğŸ‘‰é‚£ä¹ˆå°±ç›´æ¥ç”¨ä¸‹é¢å³å¯</p>
<pre><code>iterator = tf.compat.v1.data.make_one_shot_iterator(dataset)
dataset = iterator.get_next()
return dataset
</code></pre>
<h1 id="tensorboard">tensorboard</h1>
<h2 id="ä½¿ç”¨æ–¹å¼1keras-callback">ä½¿ç”¨æ–¹å¼1ï¼škeras callback</h2>
<p>è®­ç»ƒå‡ºæ¨¡å‹ï¼Œç›´æ¥ç”¨tensorboardå‘½ä»¤æ¥å£ï¼Œå‰æéœ€è¦åœ¨å…·æœ‰ æ¨¡å‹æ–‡ä»¶çš„ç›®å½•ä¸‹ã€‚model.ckptã€‚</p>
<pre><code>log_dir=&quot;logs/fit/&quot; + datetime.datetime.now().strftime(&quot;%Y%m%d-%H%M%S&quot;)
callbacks = [ # put it to fit()
    keras.callbacks.TensorBoard(log_dir),
    keras.callbacks.ModelCheckpoint(save_model_file,save_best_only=True),
    keras.callbacks.EarlyStopping(patience=5, min_delta=1e-3)
]
# tensorboard --logdir &quot;logs/fit&quot;
</code></pre>
<h2 id="ä½¿ç”¨æ–¹å¼2åŸºäºtensorflow20-çš„-gradient">ä½¿ç”¨æ–¹å¼2ï¼š(åŸºäºTensorflow2.0 çš„ gradient)</h2>
<pre><code>https://www.tensorflow.org/tensorboard/get_started?hl=zh-cn
</code></pre>
<h1 id="tfrecords">TFRecords</h1>
<p>Note: ä¸€ä¸ªExampleå°±æ˜¯ğŸ‘‰ä¸€ä¸ª æ ·æœ¬</p>
<h2 id="ç¬¬ä¸€æ­¥ç”Ÿæˆtfrecord-writer">ç¬¬ä¸€æ­¥ï¼Œç”ŸæˆTFRecord Writer</h2>
<pre><code>writer = tf.data.experimental.TFRecordWriter(path, compression_type=None)
# pathï¼šTFRecordæ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼›
# compression_typeï¼šå®šä¹‰TFRecordæ–‡ä»¶ä¿å­˜çš„å‹ç¼©æ ¼å¼ï¼›
</code></pre>
<p>ä¹Ÿå¯ä»¥ç”¨çº¯pythonæ¥å£ï¼ˆå¥½å¤„å°±æ˜¯å¯ä»¥ç”¨withä¸Šä¸‹æ–‡ï¼‰ï¼š</p>
<pre><code>with tf.io.TFRecordWriter() as writer:
    xxx
</code></pre>
<h2 id="ç¬¬äºŒæ­¥tftrainfeatureç”Ÿæˆåè®®ä¿¡æ¯">ç¬¬äºŒæ­¥ï¼Œtf.train.Featureç”Ÿæˆåè®®ä¿¡æ¯</h2>
<p>featureæ˜¯ä¸€ä¸ªå­—å…¸å€¼ï¼Œå®ƒæ˜¯å°†æŸä¸ªç±»å‹åˆ—è¡¨ç¼–ç æˆç‰¹å®šçš„featureæ ¼å¼ï¼Œè€Œè¯¥å­—å…¸é”®ç”¨äºè¯»å–TFRecordsæ–‡ä»¶æ—¶ç´¢å¼•å¾—åˆ°ä¸åŒçš„æ•°æ®ï¼ŒæŸä¸ªç±»å‹åˆ—è¡¨å¯èƒ½åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œåˆ—è¡¨ç±»å‹å¦‚ä¸‹ä¸‰ç§ï¼š</p>
<pre><code>tf.train.BytesList(value=[value]) # valueè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼ˆäºŒè¿›åˆ¶ï¼‰åˆ—è¡¨
tf.train.FloatList(value=[value]) # valueè½¬åŒ–ä¸ºæµ®ç‚¹å‹åˆ—è¡¨
tf.train.Int64List(value=[value]) # valueè½¬åŒ–ä¸ºæ•´å‹åˆ—è¡¨
</code></pre>
<p>å…¶ä¸­ï¼Œvalueæ˜¯ä½ è¦ä¿å­˜çš„æ•°æ®ã€‚å†…å±‚featureç¼–ç æ–¹å¼ï¼š</p>
<pre><code>feature_internal = {
    &quot;width&quot;:tf.train.Feature(int64_list=tf.train.Int64List(value=[width])),
    &quot;weights&quot;:tf.train.Feature(float_list=tf.train.FloatList(value=[weights])),
    &quot;image_raw&quot;:tf.train.Feature(bytes_list=tf.train.BytesList(value=[image_raw]))
}
</code></pre>
<p>å¤–å±‚featureså†å°†å†…å±‚å­—å…¸ç¼–ç ï¼š</p>
<pre><code>features_extern = tf.train.Features(feature_internal)
</code></pre>
<ul>
<li>tf.train.Featureè¿™ä¸ªæ¥å£å¯ä»¥ç¼–ç å°è£…åˆ—è¡¨ç±»å‹å’Œå­—å…¸ç±»å‹ï¼Œå†…å±‚ç”¨çš„æ˜¯tf.train.Feature</li>
<li>å¤–å±‚ä½¿ç”¨tf.train.Features</li>
</ul>
<h2 id="ç¬¬ä¸‰æ­¥ä½¿ç”¨tftrainexampleå°†featuresç¼–ç æ•°æ®å°è£…æˆç‰¹å®šçš„pbåè®®æ ¼å¼">ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨tf.train.Exampleå°†featuresç¼–ç æ•°æ®å°è£…æˆç‰¹å®šçš„PBåè®®æ ¼å¼</h2>
<pre><code>example = tf.train.Example(features_extern)
</code></pre>
<h2 id="ç¬¬å››æ­¥å°†exampleæ•°æ®ç³»åˆ—åŒ–ä¸ºå­—ç¬¦ä¸²">ç¬¬å››æ­¥ï¼Œå°†exampleæ•°æ®ç³»åˆ—åŒ–ä¸ºå­—ç¬¦ä¸²</h2>
<pre><code>example_str = example.SerializeToString()
</code></pre>
<h2 id="ç¬¬äº”æ­¥å°†ç³»åˆ—åŒ–ä¸ºå­—ç¬¦ä¸²çš„exampleæ•°æ®å†™å…¥åè®®ç¼“å†²åŒº">ç¬¬äº”æ­¥ï¼Œå°†ç³»åˆ—åŒ–ä¸ºå­—ç¬¦ä¸²çš„exampleæ•°æ®å†™å…¥åè®®ç¼“å†²åŒº</h2>
<pre><code>writer.write(example_str)
</code></pre>
<h2 id="ä»¥ä¸Š5æ­¥åˆå†™">ä»¥ä¸Š5æ­¥åˆå†™</h2>
<pre><code>writer = tf.data.experimental.TFRecordWriter(path, compression_type=None)
example = tf.train.Example(
    tf.train.Features(
        {
            &quot;width&quot;: tf.train.Feature(int64_list=tf.train.Int64List(value=[width])),
            &quot;weights&quot;: tf.train.Feature(float_list=tf.train.FloatList(value=[weights])),
            &quot;image_raw&quot;: tf.train.Feature(bytes_list=tf.train.BytesList(value=[image_raw]))
        }
    )
)
example_str = example.SerializeToString()  # å°†exampleæ•°æ®ç³»åˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
writer.write(example_str)
</code></pre>
<h2 id="æ­£å¼å°†ä¸šåŠ¡æ•°æ®å†™å…¥åˆ°tfrecord">æ­£å¼å°†ä¸šåŠ¡æ•°æ®å†™å…¥åˆ°TFRecord</h2>
<ol>
<li>å°†ç‰¹å¾ä¸­å¿ƒçš„è¡¨è¯»å‡ºï¼ˆ121ä¸ªç‰¹å¾ï¼‰</li>
<li>å°†clickåˆ— å’Œ åˆå¹¶å¥½çš„featureåˆ—ç”¨select['click','feature']å‡ºæ¥ï¼Œå¹¶ collect()å–å€¼</li>
<li>å°†å–å‡ºçš„å€¼è½¬ä¸º pandas çš„ df</li>
<li>å°†dfå­˜å‚¨åˆ° TFRecord</li>
</ol>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://cythonlin.github.io/media/images/EjFvvnhFs.jpg');"></div>
                 <a href="https://cythonlin.github.io/post/rs-greater/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2021-03-03">2021-03-03</time>
                  <h4 class="title white no-margin">RS =&gt; NLP Model + TF20å¤§çº²</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://cythonlin.github.io/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://cythonlin.github.io/media/images/XH05Gb5J6.jpg');"></div>
                 <a href="https://cythonlin.github.io/post/go-greater-fu-xi/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2021-02-25">2021-02-25</time>
                  <h4 class="title white no-margin">RS =&gt; æ¨èç³»ç»Ÿï¼ˆå…­ï¼‰æ¨èç¼“å­˜æœåŠ¡+LR</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://cythonlin.github.io/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
<!--               <div id="comments" class="bg-white hosted ">
                <p>è¯·åˆ°å®¢æˆ·ç«¯â€œä¸»é¢˜--è‡ªå®šä¹‰é…ç½®--valineâ€ä¸­å¡«å…¥IDå’ŒKEY</p>
              </div> -->
              <div class="clear"></div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://cythonlin.github.io/post/ide-greater-my-sublimepy/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('/media/images/gridea.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2021-03-03">2021-03-03</time>
                      <h4 class="title usmall">
                        <a href="https://cythonlin.github.io/post/ide-greater-my-sublimepy/">IDE =&gt; My Sublimeï¼ˆPYï¼‰</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://cythonlin.github.io/post/rs-greater-9/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('/media/images/gridea.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2021-03-03">2021-03-03</time>
                      <h4 class="title usmall">
                        <a href="https://cythonlin.github.io/post/rs-greater-9/"> IDE =&gt; My Pycharm</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://cythonlin.github.io/post/rs-greater-8/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('/media/images/gridea.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2021-03-03">2021-03-03</time>
                      <h4 class="title usmall">
                        <a href="https://cythonlin.github.io/post/rs-greater-8/">GO =&gt; GolangæŒç»­...</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://cythonlin.github.io/tag/c137hZpK4/" class="ctag ctag-0 ctag-c137hZpK4" aria-label="">IDE</a>
                    
                      <a href="https://cythonlin.github.io/tag/wAXYBHxvH/" class="ctag ctag-1 ctag-wAXYBHxvH" aria-label="">Python</a>
                    
                      <a href="https://cythonlin.github.io/tag/XH05Gb5J6/" class="ctag ctag-2 ctag-XH05Gb5J6" aria-label="">Golang</a>
                    
                      <a href="https://cythonlin.github.io/tag/EjFvvnhFs/" class="ctag ctag-3 ctag-EjFvvnhFs" aria-label="">RS</a>
                    
                      <a href="https://cythonlin.github.io/tag/sKPdrpV6Y/" class="ctag ctag-4 ctag-sKPdrpV6Y" aria-label="">PR</a>
                    
                      <a href="https://cythonlin.github.io/tag/1L4lr0i2f/" class="ctag ctag-5 ctag-1L4lr0i2f" aria-label="">Docker</a>
                    
                      <a href="https://cythonlin.github.io/tag/n16me-6oV/" class="ctag ctag-6 ctag-n16me-6oV" aria-label="">AI</a>
                    
                      <a href="https://cythonlin.github.io/tag/FLS_eF6Eg/" class="ctag ctag-7 ctag-FLS_eF6Eg" aria-label="">KG</a>
                    
                      <a href="https://cythonlin.github.io/tag/sJAb6NuUK/" class="ctag ctag-8 ctag-sJAb6NuUK" aria-label="">DB</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://cythonlin.github.io/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">Cython_lin</a></h4>
                    <p class="founder"></p>
                    <div class="social">
                      
                        
                      
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://cythonlin.github.io"><img src="\media\images\custom-footerLogo.png" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2019 å…± 78 ç¯‡æ–‡ç« 
          <br/>

        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        

      
    <script src="https://cythonlin.github.io/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
